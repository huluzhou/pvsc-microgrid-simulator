# 光储充微电网系统功能需求规格文档

## 1. 引言

### 1.1 文档目的

本文档详细描述光储充微电网系统的功能需求规格，旨在明确定义系统的功能边界、用户交互方式、输入/输出规格和验收标准，为系统开发、测试和验收提供明确指导。文档面向项目经理、开发团队、测试团队和最终用户，确保所有相关方对系统功能有一致理解。

### 1.2 术语定义

| 术语 | 解释 |
|------|------|
| 光储充 | 光伏系统、储能系统和充电设施的组合 |
| 微电网 | 小型电力网络，包含分布式能源资源和负载，可并网运行或孤岛运行 |
| Modbus TCP | 工业以太网通信协议，用于设备间的数据交换 |
| 潮流计算 | 电力系统分析方法，用于确定系统稳态运行时的电压、电流和功率分布 |
| 拓扑 | 描述微电网中设备连接关系的图形表示 |
| 回测 | 使用历史数据模拟系统运行，验证系统功能和性能 |
| 随机数据模式 | 随机生成设备数据的工作模式 |
| 历史数据模式 | 通过历史数据生成设备数据的工作模式，支持本地数据库和 SSH 远程数据库访问 |
| Tauri | 跨平台应用框架，使用 Rust 后端和 Web 前端 |
| React Flow | 用于拓扑图可视化的 React 库 |

## 2. 系统概述

### 2.1 系统目标

光储充微电网系统是一个基于 Tauri 框架的跨平台应用，使用 Rust 作为后端业务逻辑层，Python 作为计算内核和 AI 内核，React + TypeScript 作为前端界面。系统提供可视化的拓扑设计、实时的数据监控、灵活的设备控制、高效的历史数据回测和深入的数据分析功能。系统支持 Modbus TCP 服务端模式，用于模拟真实光储充微电网设备，支持测试验证和仿真分析。

### 2.2 系统范围

本系统主要功能模块包括：
- 拓扑设计模块（Rust 数据模型 + React Flow UI）
- 实时监控模块（数据采集、图表展示、告警）
- 设备控制模块（工作模式配置、批量操作）
- 仿真引擎模块（支持四种工作模式：随机数据、手动、远程、历史数据）
- 数据分析模块（性能分析、报告生成）
- AI 智能模块（数据预测、运行优化）
- 功率计算模块（支持切换不同计算内核：pandapower、PyPSA、GridCal）

## 3. 功能需求（Functional Requirements）

### 3.1 拓扑设计模块

#### 3.1.1 功能描述
允许用户通过可视化界面设计和编辑光储充微电网的拓扑结构，包括设备添加、删除、连接和属性配置。

#### 3.1.2 用户故事
- 作为系统管理员，我希望能够通过拖拽方式快速创建微电网拓扑，以便高效完成系统配置
- 作为工程师，我希望能够方便地导入和导出拓扑文件，以便在不同环境间共享和迁移配置

#### 3.1.3 输入规格
- 拓扑文件（JSON格式）：通过导入功能提供
- 用户操作：鼠标拖拽、点击、连线操作
- 设备属性参数：通过属性面板输入

#### 3.1.4 输出规格
- 可视化拓扑图：在画布上实时显示
- 拓扑文件（JSON格式）：通过导出功能生成
- 操作日志：记录所有编辑操作

#### 3.1.5 功能点详细规格
- **F-TOP-001 拓扑文件操作**
  - 新建空白拓扑
  - 导入现有拓扑文件
  - 导出拓扑为JSON文件
  - 保存当前拓扑

- **F-TOP-002 设备添加与配置**
  - 提供设备面板，包含以下可拖拽设备类型：
    - 节点设备：母线
    - 连接设备：线路、变压器、开关
    - 功率设备：光伏、储能、负载、充电桩
    - 测量设备：电表
  - 支持设备属性查看和修改
  - 支持设备删除和复制

- **F-TOP-003 拓扑编辑功能**
  - 设备连接：通过鼠标拖拽方式连接设备
  - 连接验证：自动验证连接合法性
  - 视图操作：画布放大、缩小、平移、自适应大小
  - 撤销/重做操作

- **F-TOP-004 拓扑校验**
  - 验证拓扑连通性
  - 检测并提示非法连接
  - 验证设备参数完整性和有效性

#### 3.1.6 验收标准
1. 用户能成功创建、导入、导出拓扑文件
2. 设备拖拽和连接操作流畅且响应及时（延迟<500ms）
3. 拓扑校验功能能准确识别并提示错误配置
4. 操作日志完整记录所有编辑操作

### 3.2 实时监控模块

#### 3.2.1 功能描述
提供设备实时运行数据的可视化展示和监控功能，包括数据曲线显示、设备状态查看和数据自动记录。

#### 3.2.2 用户故事
- 作为运维人员，我希望能够实时监控所有设备的运行状态和关键参数，以便及时发现并处理异常
- 作为数据分析师，我希望系统能自动记录设备数据，以便进行后续的数据分析和趋势研究

#### 3.2.3 输入规格
- 系统内部实时运行数据
- 用户选择的设备和数据项

#### 3.2.4 输出规格
- 实时数据曲线图
- 设备列表及状态显示
- 设备详细参数信息
- 数据记录文件（SQLite数据库）

#### 3.2.5 功能点详细规格
- **F-MON-001 数据曲线展示**
  - 实时显示设备运行数据曲线
  - 支持多设备数据曲线对比显示
  - 支持不同数据类型（电压、电流、功率等）的曲线展示
  - 支持曲线缩放、平移和时间范围调整

- **F-MON-002 设备列表管理**
  - 显示所有设备及其关键运行参数
  - 支持设备搜索和筛选
  - 支持将设备添加到/移除出数据曲线图
  - 显示设备在线/离线状态

- **F-MON-003 设备详细参数**
  - 显示设备所有运行参数和状态信息
  - 参数值实时更新
  - 异常参数值高亮显示

- **F-MON-004 数据自动记录**
  - 自动将设备实时数据记录到SQLite数据库
  - 可配置数据记录频率（默认1秒/条）
  - 支持历史数据查询和回放

#### 3.2.6 验收标准
1. 数据曲线实时更新，延迟不超过1秒
2. 同时显示10个设备数据时系统响应无明显延迟
3. 数据记录功能正常工作，数据完整性达到100%
4. 异常参数能被正确识别并高亮显示

### 3.3 设备控制模块

#### 3.3.1 功能描述
提供对系统中设备的远程控制功能，包括开关控制、参数调节和状态管理。

#### 3.3.2 用户故事
- 作为系统操作员，我希望能够远程控制设备的开关状态，以便灵活管理系统运行
- 作为工程师，我希望能够调节设备的输出功率，以便测试不同运行条件下的系统性能

#### 3.3.3 输入规格
- 用户控制指令
- 设备参数设置值
- 自动生成的模拟数据配置

#### 3.3.4 输出规格
- 设备状态更新
- 控制指令执行结果
- 操作历史记录

#### 3.3.5 功能点详细规格
- **F-CON-001 设备列表管理**
  - 显示所有可控制设备
  - 支持设备搜索和筛选
  - 显示设备当前状态（在线/离线、运行/停止）

- **F-CON-002 设备开关控制**
  - 支持设备远程启停操作
  - 控制指令执行状态反馈
  - 紧急停止功能

- **F-CON-003 通信状态管理**
  - 显示设备通信连接状态
  - 支持手动重连设备
  - 通信异常告警

- **F-CON-004 功率参数调节**
  - 支持调节设备有功功率输出
  - 支持设置功率限制值
  - 参数调节范围验证

- **F-CON-005 模拟数据生成**
  - 支持配置模拟数据生成规则
  - 提供标准数据模式（正弦波、阶跃变化等）
  - 支持导入自定义数据模式

- **F-CON-006 操作历史记录**
  - 记录所有控制操作的详细信息
  - 支持操作日志查询和筛选
  - 记录操作执行结果

#### 3.3.6 验收标准
1. 设备控制指令执行延迟不超过1秒
2. 控制操作有明确的成功/失败反馈
3. 操作历史记录完整且可追溯
4. 模拟数据生成符合预期的模式和范围

### 3.4 数据回测模块

#### 3.4.1 功能描述
提供基于历史数据的系统运行模拟功能，用于测试和验证系统在不同条件下的性能表现。

#### 3.4.2 用户故事
- 作为系统测试人员，我希望能够使用历史数据进行系统回测，以便验证系统的稳定性和准确性
- 作为工程师，我希望能够精确控制回测的时间范围和速率，以便针对性地分析系统行为

#### 3.4.3 输入规格
- **本地模式**：SQLite数据库中的历史数据（本地文件路径）
- **远程模式**：SSH 连接配置（主机、端口、用户名、认证方式）和远程数据库路径
- 回测配置参数（日期范围、时间段、回测速率等）

#### 3.4.4 输出规格
- 回测过程状态信息
- 回测结果数据
- 回测操作日志
- 导出的回测数据

#### 3.4.5 功能点详细规格
- **F-BACK-001 数据源配置**
  - 支持选择本地 SQLite 数据库作为回测数据源
  - **支持通过 SSH 连接远程服务器，直接访问远程数据库**（参考 remote-tool 实现）
  - 支持密码和密钥文件两种 SSH 认证方式
  - 支持指定回测的日期范围和时间段
  - 支持数据完整性验证
  - SSH 连接状态在历史数据模式和数据分析模块间共享

- **F-BACK-002 回测参数设置**
  - 支持设置回测速率（实时、2倍速、5倍速等）
  - 支持选择参与回测的设备范围
  - 支持设置回测启动和停止条件

- **F-BACK-003 回测过程监控**
  - 实时显示回测运行状态
  - 显示已运行时间和预计剩余时间
  - 支持回测暂停、继续和停止操作
  - 支持回测进度调整

- **F-BACK-004 回测结果管理**
  - 支持将回测数据导出至SQLite数据库
  - 提供回测结果与实时数据的对比功能
  - 回测操作日志记录

#### 3.4.6 验收标准
1. 回测功能能正确加载和使用历史数据
2. 不同回测速率设置能正常工作
3. 回测过程中能正确响应暂停、继续和停止操作
4. 回测结果数据导出完整且格式正确

### 3.5 数据分析模块

#### 3.5.1 功能描述
提供对系统运行数据的深入分析和报告生成功能，帮助用户了解系统性能、识别问题和优化运行。

#### 3.5.2 用户故事
- 作为分析师，我希望能够对系统运行数据进行多维度分析，以便发现潜在问题和优化机会
- 作为管理人员，我希望系统能自动生成专业的分析报告，以便快速了解系统运行状况和经济效益

#### 3.5.3 输入规格
- 历史运行数据（来自SQLite数据库）
- 分析配置参数（日期范围、设备选择、分析类型等）

#### 3.5.4 输出规格
- 数据可视化图表
- 分析结果报告（多种格式）
- 关键指标摘要

#### 3.5.5 功能点详细规格
- **F-ANA-001 数据源配置**
  - 支持从SQLite数据库选择分析数据源
  - 支持灵活指定分析的日期范围和时间段
  - 支持数据有效性检查

- **F-ANA-002 数据筛选与选择**
  - 支持多选设备进行组合分析
  - 支持选择特定数据项进行分析
  - 提供数据过滤和预处理功能

- **F-ANA-003 数据可视化**
  - 以曲线图形式展示数据变化趋势
  - 支持多数据集对比显示
  - 支持图表交互（缩放、平移、数据点查询）
  - 支持图表导出（PNG、PDF等格式）

- **F-ANA-004 分析报告生成**
  - 自动生成多种专业分析报告：
    - 故障分析报告：识别设备异常和故障模式
    - 调节性能分析：评估设备响应和调节能力
    - 调控效果分析：分析控制策略的实施效果
    - 设备利用率分析：统计设备运行和使用效率
    - 收益分析：计算系统运行的经济收益
  - 支持报告导出（PDF、Excel等格式）
  - 支持报告自定义模板

#### 3.5.6 验收标准
1. 分析功能能正确处理至少30天的历史数据
2. 数据可视化图表生成时间不超过3秒
3. 分析报告内容完整、准确，包含所有规定的分析维度
4. 报告导出功能正常工作，格式符合标准

### 3.6 功率计算模块

#### 3.6.1 功能描述
实现基于pandapower框架的电力系统潮流计算功能，为系统提供准确的电力参数计算和分析支持。

#### 3.6.2 用户故事
- 作为工程师，我希望系统能准确计算电力网络的潮流分布，以便验证系统设计和运行状态
- 作为开发人员，我希望计算模块能与其他功能无缝集成，为实时监控和控制提供数据基础

#### 3.6.3 输入规格
- 设备设定值（自动生成、手动配置或外部获取）
- 拓扑结构信息

#### 3.6.4 输出规格
- 潮流计算结果（电压、电流、功率等）
- 计算状态和错误信息

#### 3.6.5 功能点详细规格
- **F-CAL-001 数据管理**
  - 管理设备设定值（自动生成、手动配置、外部获取）
  - 存储和提供计算结果
  - 支持数据版本管理

- **F-CAL-002 潮流计算引擎**
  - 基于抽象接口设计，支持切换不同计算内核
  - 默认使用 pandapower 框架实现潮流计算
  - 支持切换为 PyPSA、GridCal 等其他计算库
  - 支持AC潮流计算和DC潮流计算
  - 提供计算收敛性检查
  - 支持计算结果验证

- **F-CAL-003 计算调度与优化**
  - 支持实时计算和按需计算
  - 优化计算性能和资源使用
  - 处理计算异常和错误

- **F-CAL-004 计算结果应用**
  - 计算结果实时提供给监控模块
  - 计算结果用于设备控制决策
  - 计算结果用于数据分析

#### 3.6.6 验收标准
1. 潮流计算结果与标准测试用例对比误差小于0.5%
2. 标准拓扑的计算时间不超过1秒
3. 计算异常情况下能给出明确的错误信息
4. 计算结果能正确应用于其他功能模块

## 4. 非功能需求（Non-Functional Requirements）

### 4.1 性能需求
- 系统响应时间：UI操作响应时间不超过1秒
- 数据处理能力：能同时处理至少50个设备的数据
- 计算性能：潮流计算在标准配置下完成时间不超过1秒
- 并发用户：支持至少10个并发用户访问

### 4.2 可用性需求
- 系统可用性：≥99.5%
- 平均故障恢复时间：≤30分钟
- 支持断点续传：系统重启后能恢复之前的配置和状态

### 4.3 安全需求
- 访问控制：基于角色的用户权限管理
- 数据安全：敏感数据加密存储
- 操作审计：记录所有关键操作的审计日志
- 通信安全：支持安全的Modbus通信

### 4.4 可扩展性需求
- 模块化设计：支持功能模块独立升级和扩展
- 设备类型扩展：支持添加新的设备类型
- 通信协议扩展：支持扩展新的通信协议

### 4.5 兼容性需求
- 操作系统：支持Windows 10/11 64位系统
- 数据库：兼容SQLite 3.x
- 浏览器：支持主流浏览器（Chrome 90+、Firefox 88+、Edge 90+）

## 5. 数据需求

### 5.1 数据模型
- **拓扑数据**：设备类型、连接关系、设备参数等
- **实时运行数据**：电压、电流、功率、温度等设备运行参数
- **历史数据**：设备运行历史记录
- **配置数据**：系统配置、用户设置等
- **分析结果**：各类分析报告数据

### 5.2 数据存储
- 实时数据：内存缓存 + SQLite数据库
- 历史数据：SQLite数据库
- 配置数据：JSON配置文件
- 分析结果：SQLite数据库 + 导出文件（PDF、Excel等）

### 5.3 数据管理
- 数据备份与恢复：支持手动和自动备份
- 数据清理策略：支持配置数据保留期限
- 数据导入/导出：支持标准格式的数据交换

## 6. 范围限定

### 6.1 系统边界
- 本系统是一个模拟环境，不直接控制真实物理设备
- 系统主要支持Modbus TCP协议通信
- 系统计算基于pandapower框架，受其计算能力限制

### 6.2 排除功能
- 不支持真实设备的直接控制操作
- 不支持除Modbus TCP外的其他工业协议（可通过扩展实现）
- 不包含高级人工智能算法的预测分析功能
- 不支持大规模电网（节点数>100）的实时计算

## 7. 验收标准

### 7.1 功能验收
- 所有功能需求中的功能点均能正常实现
- 每个功能点通过至少3个测试用例的验证
- 用户界面操作流畅，符合直觉

### 7.2 性能验收
- 系统响应时间满足规定要求
- 在最大负载条件下系统稳定运行24小时无异常
- 数据处理和计算性能符合规格要求

### 7.3 文档验收
- 系统操作手册完整且准确
- API文档齐全且与实际实现一致
- 技术文档符合公司标准

### 7.4 最终验收
- 通过所有功能和性能测试
- 系统部署和配置文档完备
- 用户培训完成并获得用户确认

## 8. 风险与依赖

### 8.1 风险
- 大规模拓扑的潮流计算性能可能不满足实时性要求
- 历史数据量过大可能影响系统响应速度
- Modbus通信可能受到网络环境影响

### 8.2 依赖
- pandapower框架：用于电力系统潮流计算
- SQLite数据库：用于数据存储
- PyQt/PySide：用于图形用户界面
- pymodbus：用于Modbus通信实现

