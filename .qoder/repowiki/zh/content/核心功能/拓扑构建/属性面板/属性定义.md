# 属性定义

<cite>
**本文档引用的文件**   
- [properties_panel.py](file://src/components/properties_panel.py#L510-L789)
- [network_items.py](file://src/components/network_items.py#L1163-L1319)
- [topology_one_level_with_connections.json](file://topology_one_level_with_connections.json)
</cite>

## 目录
1. [方法概述](#方法概述)
2. [属性元数据结构](#属性元数据结构)
3. [条件显示逻辑](#条件显示逻辑)
4. [扩展新元件类型](#扩展新元件类型)

## 方法概述

`get_component_properties` 方法是 `pp_tool` 项目中用于定义所有电网元件属性结构的核心方法。该方法位于 `src/components/properties_panel.py` 文件中，通过返回一个包含所有元件类型及其属性定义的字典，为用户界面提供统一的属性配置。每个元件类型（如母线、线路、变压器、负载、储能、充电桩、光伏等）都有其特定的属性集合，这些属性在用户界面中以表单形式展示，支持用户进行配置和修改。

**Section sources**
- [properties_panel.py](file://src/components/properties_panel.py#L510-L789)

## 属性元数据结构

每个属性的定义包含多个元数据字段，用于描述属性的类型、显示标签、默认值、取值范围、小数位数以及选项列表。以下是各元数据字段的详细说明：

- **type**: 属性的数据类型，常见的类型包括 `float`（浮点数）、`int`（整数）、`bool`（布尔值）、`str`（字符串）、`choice`（选择项）和 `readonly`（只读）。
- **label**: 属性的显示标签，用于在用户界面中显示属性名称。
- **default**: 属性的默认值，当用户未指定值时使用。
- **min/max**: 属性的取值范围，用于限制用户输入的有效值。
- **decimals**: 浮点数属性的小数位数，用于控制显示精度。
- **choices**: 选择项属性的选项列表，用户可以从预定义的选项中选择一个值。

例如，线路元件的 `length_km` 属性定义如下：
```python
'length_km': {'type': 'float', 'label': '长度 (km)', 'default': 1.0, 'min': 0.001, 'max': 1000.0, 'decimals': 3}
```

**Section sources**
- [properties_panel.py](file://src/components/properties_panel.py#L510-L789)

## 条件显示逻辑

`get_component_properties` 方法中的条件显示逻辑通过 `condition` 字段实现，该字段定义了属性的显示条件。当某个属性的 `condition` 字段中的条件满足时，该属性才会在用户界面中显示。这种机制允许用户根据不同的配置选择显示或隐藏某些属性，从而简化用户界面并提高用户体验。

### 线路和变压器的 `use_standard_type` 属性

线路和变压器元件的 `use_standard_type` 属性用于控制标准参数与自定义参数的切换。当 `use_standard_type` 为 `True` 时，显示标准类型参数；当 `use_standard_type` 为 `False` 时，显示自定义参数。

- **线路元件**:
  - 当 `use_standard_type` 为 `True` 时，显示 `std_type` 属性。
  - 当 `use_standard_type` 为 `False` 时，显示 `r_ohm_per_km`、`x_ohm_per_km`、`c_nf_per_km`、`r0_ohm_per_km`、`x0_ohm_per_km`、`c0_nf_per_km` 和 `max_i_ka` 属性。

- **变压器元件**:
  - 当 `use_standard_type` 为 `True` 时，显示 `std_type` 属性。
  - 当 `use_standard_type` 为 `False` 时，显示 `sn_mva`、`vn_hv_kv`、`vn_lv_kv`、`vkr_percent`、`vk_percent`、`pfe_kw`、`i0_percent` 和 `vector_group` 属性。

### 光伏、负载、充电桩的 `use_power_factor` 属性

光伏、负载和充电桩元件的 `use_power_factor` 属性用于在直接功率模式和功率因数模式之间切换。当 `use_power_factor` 为 `True` 时，显示功率因数模式参数；当 `use_power_factor` 为 `False` 时，显示直接功率模式参数。

- **光伏元件**:
  - 当 `use_power_factor` 为 `True` 时，显示 `cos_phi` 和 `mode` 属性。
  - 当 `use_power_factor` 为 `False` 时，显示 `p_mw` 属性。

- **负载元件**:
  - 当 `use_power_factor` 为 `True` 时，显示 `cos_phi` 和 `mode` 属性。
  - 当 `use_power_factor` 为 `False` 时，显示 `p_mw` 属性。

- **充电桩元件**:
  - 当 `use_power_factor` 为 `True` 时，显示 `cos_phi` 和 `mode` 属性。
  - 当 `use_power_factor` 为 `False` 时，显示 `p_mw` 属性。

**Section sources**
- [properties_panel.py](file://src/components/properties_panel.py#L510-L789)
- [network_items.py](file://src/components/network_items.py#L1163-L1319)

## 扩展新元件类型

为了扩展新的元件类型，如电容器组，需要在 `get_component_properties` 方法中添加相应的属性定义。以下是一个示例，展示如何为电容器组添加属性定义：

```python
'capacitor': {
    'index': {'type': 'readonly', 'label': '组件索引'},
    'geodata': {'type': 'readonly', 'label': '位置'},
    'q_mvar': {'type': 'float', 'label': '无功功率 (Mvar)', 'default': 1.0, 'min': 0.0, 'max': 1000.0, 'decimals': 3},
    'vn_kv': {'type': 'float', 'label': '额定电压 (kV)', 'default': 10.0, 'min': 0.1, 'max': 1000.0, 'decimals': 3},
    'in_service': {'type': 'bool', 'label': '投入运行', 'default': True},
    'bus': {'type': 'readonly', 'label': '连接母线', 'default': ''}
}
```

通过这种方式，可以轻松地为新的元件类型添加属性定义，确保用户界面的一致性和可扩展性。

**Section sources**
- [properties_panel.py](file://src/components/properties_panel.py#L510-L789)