@tailwind base;
@tailwind components;
@tailwind utilities;

/* 全局禁用文本选择 - 防止鼠标变成工字光标 */
* {
  user-select: none;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  cursor: default;
}

/* 允许输入框、文本区域可以选择文本 */
input,
textarea,
[contenteditable="true"],
.allow-select {
  user-select: text !important;
  -webkit-user-select: text !important;
  -moz-user-select: text !important;
  -ms-user-select: text !important;
  cursor: text;
}

/* 防止拖拽时意外选择文本 */
.react-flow__pane,
.react-flow__node,
.react-flow__edge {
  user-select: none;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
}

/* ReactFlow 画布缩放优化 - 防止 SVG 和文本模糊 */
.react-flow__viewport {
  /* 触发 GPU 加速，提高缩放渲染质量 */
  transform-style: preserve-3d;
  backface-visibility: hidden;
}

.react-flow__node svg {
  /* SVG 缩放优化 */
  shape-rendering: geometricPrecision;
  text-rendering: geometricPrecision;
}

.react-flow__node svg line,
.react-flow__node svg circle,
.react-flow__node svg rect,
.react-flow__node svg path {
  /* 防止线条在缩放时变形 */
  vector-effect: non-scaling-stroke;
}

/* ReactFlow 连接点捕获反馈样式 - 类似 CAD 的捕捉效果 */
.react-flow__handle {
  transition: all 0.15s ease;
  /* 使用指针光标 */
  cursor: pointer !important;
}

/* 连接过程中，可连接的目标 Handle 显示绿色高亮圆圈 */
.react-flow__handle.connectingto,
.react-flow__handle.valid {
  background-color: #22c55e !important;  /* 绿色表示可连接 */
  border: 2px solid #fff !important;
  /* 使用 box-shadow 创建高亮圆圈，确保以连接点为中心（不缩放元素本身，避免定位偏移） */
  box-shadow: 0 0 0 4px rgba(34, 197, 94, 0.4), 0 0 0 7px #22c55e, 0 0 12px 8px rgba(34, 197, 94, 0.5) !important;
}

/* 连接过程中，无效的目标 Handle（即使验证失败也显示高亮，让用户看到连接点） */
.react-flow__handle.connectingfrom {
  background-color: #3b82f6 !important;  /* 蓝色表示起点 */
  box-shadow: 0 0 0 2px #3b82f6, 0 0 6px 2px rgba(59, 130, 246, 0.4) !important;
}

/* 连接线悬停在 Handle 上时的红色高亮圆圈 - 无论连接点是否被占用都显示 */
.react-flow__handle:hover {
  background-color: #ef4444 !important;
  /* 使用 box-shadow 创建高亮圆圈，确保以连接点为中心（不缩放元素本身，避免定位偏移） */
  box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.4), 0 0 0 6px rgba(239, 68, 68, 0.2) !important;
}

/* 连接过程中，所有可捕获的连接点都显示高亮（即使验证可能失败） */
.react-flow__handle.connecting {
  /* 确保连接过程中所有连接点都能被看到 */
  box-shadow: 0 0 0 3px rgba(34, 197, 94, 0.3), 0 0 0 6px rgba(34, 197, 94, 0.2) !important;
}

/* 连接模式下的画布光标 */
.react-flow__pane.connecting {
  cursor: pointer !important;
}

.react-flow__node.connecting {
  cursor: pointer !important;
}

/* 确保拖拽时的视觉反馈 */
[draggable="true"] {
  cursor: grab !important;
  user-select: none;
}

[draggable="true"]:active {
  cursor: grabbing !important;
}

/* 按钮和链接保持指针光标 */
button,
a,
[role="button"],
.cursor-pointer {
  cursor: pointer !important;
}

:root {
  font-family: Inter, system-ui, Avenir, Helvetica, Arial, sans-serif;
  line-height: 1.5;
  font-weight: 400;

  font-synthesis: none;
  text-rendering: optimizeLegibility;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

:root:not(.dark) {
  color-scheme: light;
  color: #1a1a1a;
  background-color: #ffffff;
}

:root.dark {
  color-scheme: dark;
  color: rgba(255, 255, 255, 0.87);
  background-color: #1a1a1a;
}

body {
  margin: 0;
  display: flex;
  min-width: 1280px;
  min-height: 600px;
}

@media (max-width: 1280px) {
  body {
    min-width: 100%;
  }
}

#root {
  width: 100%;
  height: 100vh;
}

* {
  box-sizing: border-box;
}
